-- Copyright (c) 2020 De Staat der Nederlanden, Ministerie van   Volksgezondheid, Welzijn en Sport. 
-- Licensed under the EUROPEAN UNION PUBLIC LICENCE v. 1.2 - see https://github.com/minvws/nl-contact-tracing-app-coordinationfor more information.

CREATE OR ALTER VIEW VWSDEST.V_RESULTS_PER_REGION AS
SELECT 
    [DATE_OF_REPORT_UNIX],
    VRCODE,
    DBO.NO_NEGATIVE_NUMBER_F(TOTAL_REPORTED_INCREASE_PER_REGION) AS TOTAL_REPORTED_INCREASE_PER_REGION,
    DBO.NO_NEGATIVE_NUMBER_F(INFECTED_TOTAL_COUNTS_PER_REGION) AS INFECTED_TOTAL_COUNTS_PER_REGION,
	DBO.NO_NEGATIVE_NUMBER_F(HOSPITAL_TOTAL_COUNTS_PER_REGION) AS HOSPITAL_TOTAL_COUNTS_PER_REGION,
	DBO.NO_NEGATIVE_NUMBER_F(INFECTED_INCREASE_PER_REGION) AS INFECTED_INCREASE_PER_REGION,
	DBO.NO_NEGATIVE_NUMBER_F(HOSPITAL_INCREASE_PER_REGION) AS HOSPITAL_INCREASE_PER_REGION,
	DBO.NO_NEGATIVE_NUMBER_F(HOSPITAL_MOVING_AVG_PER_REGION) AS HOSPITAL_MOVING_AVG_PER_REGION,
    dbo.CONVERT_DATETIME_TO_UNIX(DATE_LAST_INSERTED) AS DATE_OF_INSERTION_UNIX
FROM VWSDEST.RESULTS_PER_REGION
WHERE DATE_OF_REPORT >=  '2020-03-16 00:00:00.000'
AND DATE_LAST_INSERTED = (SELECT MAX(DATE_LAST_INSERTED)
                            FROM VWSDEST.RESULTS_PER_REGION);