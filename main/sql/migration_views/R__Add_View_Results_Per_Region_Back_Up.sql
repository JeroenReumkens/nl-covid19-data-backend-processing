-- Copyright (c) 2020 De Staat der Nederlanden, Ministerie van   Volksgezondheid, Welzijn en Sport. 
-- Licensed under the EUROPEAN UNION PUBLIC LICENCE v. 1.2 - see https://github.com/minvws/nl-contact-tracing-app-coordinationfor more information.

CREATE OR ALTER VIEW VWSDEST.V_RESULTS_PER_REGION_BACK_UP AS
SELECT 
    ROW_NUMBER() OVER (ORDER BY DATE_OF_REPORT_UNIX ASC) AS ID,
    DATE_OF_REPORT,
	DATE_OF_REPORT_UNIX,
	VRCODE,
	TOTAL_REPORTED_INCREASE_PER_REGION,
	INFECTED_TOTAL_COUNTS_PER_REGION,
	HOSPITAL_TOTAL_COUNTS_PER_REGION,
	INFECTED_INCREASE_PER_REGION,
	HOSPITAL_INCREASE_PER_REGION,
	INFECTED_MOVING_AVG_PER_REGION,
	HOSPITAL_MOVING_AVG_PER_REGION,
	DATE_LAST_INSERTED
FROM VWSDEST.RESULTS_PER_REGION
WHERE DATE_LAST_INSERTED = (SELECT MAX(DATE_LAST_INSERTED)
                            FROM VWSDEST.RESULTS_PER_REGION);